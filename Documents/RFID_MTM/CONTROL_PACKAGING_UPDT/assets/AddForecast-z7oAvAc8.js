import{i as S,a as s,j as e}from"./index-fIXkcG0q.js";import{a as u}from"./axios-B17pQD9q.js";import{S as o}from"./sweetalert2.esm.all-BQxta0Da.js";import{C as j,a as c}from"./CRow-B962IMet.js";import{C as F,a as w}from"./CCardBody-CRtrtls-.js";import{C as B}from"./CCardHeader-Nag4upoQ.js";import{C as x}from"./CFormSelect-2df0xZQG.js";import{C as h}from"./CFormInput-RZ7mtaEn.js";import{a as N}from"./index.esm-Cme2ool-.js";import"./CFormControlWrapper-wuPxfQED.js";import"./CFormControlValidation-Cldlh3vc.js";import"./CFormLabel-BxnjwlR-.js";const H=()=>{const f=S(),[l,_]=s.useState(""),[d,C]=s.useState(""),[n,k]=s.useState(""),[b,v]=s.useState([]),[i,m]=s.useState([]);s.useEffect(()=>{u.get("/customers").then(a=>v(a.data)).catch(console.error)},[]),s.useEffect(()=>{if(!n){m([]);return}u.get(`/parts/by-customer/${n}`).then(a=>{const r=a.data.map(t=>({id:t.id,part_name:t.part_name,packaging_id:t.packaging_id,forecast_month:"",actual_packaging:"",kalender_kerja:0,lead_time:0}));m(r)}).catch(console.error)},[n]);const p=(a,r,t)=>{const g=[...i];g[a][r]=t,m(g)},y=async()=>{if(!l||!d||!n){o.fire("Warning","Bulan, Tahun, dan Customer wajib diisi","warning");return}for(const a of i){if(!a.forecast_month){o.fire("Warning","Forecast per month wajib diisi untuk semua part","warning");return}if(a.packaging_id==null){o.fire("Warning",`Part ${a.part_name} tidak punya packaging_id`,"warning");return}}try{const a={bulan:l,tahun:d,items:i.map(r=>({part_id:r.id,packaging_id:r.packaging_id,forecast_month:Number(r.forecast_month),actual_packaging:Number(r.actual_packaging||0),kalender_kerja:r.kalender_kerja||0,lead_time:r.lead_time||0}))};await u.post("/forecast/bulk",a),o.fire("Berhasil","Forecast berhasil disimpan","success"),f("/forecast")}catch(a){console.error(a),o.fire("Error","Gagal menyimpan forecast","error")}};return e.jsx(j,{children:e.jsx(c,{xs:12,children:e.jsxs(F,{children:[e.jsx(B,{children:e.jsx("strong",{children:"Tambah Forecast Bulanan"})}),e.jsxs(w,{children:[e.jsxs(j,{className:"mb-4",children:[e.jsx(c,{md:4,children:e.jsxs(x,{value:l,onChange:a=>_(a.target.value),children:[e.jsx("option",{value:"",children:"Pilih Bulan"}),["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"].map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx(c,{md:4,children:e.jsx(h,{placeholder:"Tahun",value:d,onChange:a=>C(a.target.value)})}),e.jsx(c,{md:4,children:e.jsxs(x,{value:n,onChange:a=>k(a.target.value),children:[e.jsx("option",{value:"",children:"Pilih Customer"}),b.map(a=>e.jsx("option",{value:a.id,children:a.customer_name},a.id))]})})]}),i.length>0&&e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Part"}),e.jsx("th",{children:"Forecast / Month"}),e.jsx("th",{children:"Actual Packaging"})]})}),e.jsx("tbody",{children:i.map((a,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.part_name}),e.jsx("td",{children:e.jsx(h,{type:"number",min:"0",value:a.forecast_month,onChange:t=>p(r,"forecast_month",t.target.value)})}),e.jsx("td",{children:e.jsx(h,{type:"number",min:"0",value:a.actual_packaging,onChange:t=>p(r,"actual_packaging",t.target.value)})})]},a.id))})]}),e.jsx(N,{color:"success",onClick:y,children:"Simpan Forecast"})]})]})})})};export{H as default};
