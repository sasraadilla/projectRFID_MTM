import{a as o,j as e,C as B}from"./index-fIXkcG0q.js";import{a as v,c as A}from"./index.esm-Cme2ool-.js";import{a as _}from"./axios-B17pQD9q.js";import{S as b}from"./sweetalert2.esm.all-BQxta0Da.js";import{c as L,a as z}from"./cil-cloud-upload-DTa66xq_.js";import{C as F,a as w}from"./CRow-B962IMet.js";import{C as W,e as R,b as x,c as s,a as E,d as n}from"./CTable-DnddnBdL.js";import{c as K}from"./cil-chart-ul2n6BfS.js";const X=()=>{const[g,m]=o.useState([]),[p,$]=o.useState([]),[l,N]=o.useState(new Date().getFullYear().toString()),[f,P]=o.useState(""),[I,u]=o.useState(!1),h=o.useRef(null),T=o.useCallback(async()=>{try{const t=await _.get("/customers");$(t.data)}catch(t){console.error("Error loading filter data:",t)}},[]),y=o.useCallback(async()=>{if(!l){b.fire("Info","Pilih tahun terlebih dahulu","warning");return}u(!0);try{let t=`/forecast/calc?year=${l}`;f&&(t+=`&customer_id=${f}`);const a=await _.get(t);m(a.data)}catch(t){console.error(t);const a=t.response?.data?.message||t.message||"Gagal mengambil data kalkulasi";b.fire("Error",a,"error")}finally{u(!1)}},[l,f]);o.useEffect(()=>{const t=document.createElement("link");t.href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap",t.rel="stylesheet",document.head.appendChild(t);const a=document.createElement("style");return a.innerHTML="* { font-family: 'Plus Jakarta Sans', sans-serif !important; }",document.head.appendChild(a),T(),y(),()=>{document.head.removeChild(t),document.head.removeChild(a)}},[T,y]);const D=async t=>{const a=t.target.files[0];if(!a)return;const i=new FormData;i.append("file",a),u(!0);try{await _.post("/forecast/import",i,{headers:{"Content-Type":"multipart/form-data"}}),b.fire("Berhasil","Data forecast berhasil diimport","success"),y()}catch(d){console.error(d),b.fire("Error","Gagal import CSV","error")}finally{u(!1),h.current&&(h.current.value="")}},U=()=>{h.current&&h.current.click()},M=[{part_number:"123",part_name:"ABC",customer_name:"PT.ADM",packaging:"Polybox",qty_packaging:10,hari_kerja:20,forecasts:{[`Oktober_${parseInt(l)-1}`]:1e3,[`November_${parseInt(l)-1}`]:1200,[`Desember_${parseInt(l)-1}`]:1100,[`Januari_${l}`]:1300,[`Februari_${l}`]:1200},need_prod:5,need_store:5,need_cust:5,total_need:15,actual:12,gap:-3,status:"Kurang",lt_production:1,lt_store:1,lt_customer:1}],c=g.length>0?g:M,S={Kurang:c.filter(t=>t.status==="Kurang").length,Lebih:c.filter(t=>t.status==="Lebih").length,Pass:c.filter(t=>t.status==="Pass").length},r={backgroundColor:"#3b82f6 !important",color:"white !important",verticalAlign:"middle",textAlign:"center",fontWeight:"700",fontSize:"0.85rem",border:"1px solid rgba(255,255,255,0.2) !important"},j={background:"white",borderRadius:"20px",padding:"25px",boxShadow:"0 10px 30px rgba(0,0,0,0.03)",border:"none",marginBottom:"25px"};return e.jsxs("div",{style:{padding:"24px",backgroundColor:"#f8fafc",minHeight:"100vh"},children:[e.jsx("input",{type:"file",ref:h,style:{display:"none"},accept:".csv",onChange:D}),e.jsx("div",{style:j,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"20px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{fontWeight:"800",color:"#1e293b",margin:0,fontSize:"1.5rem",letterSpacing:"-0.5px"},children:"KEBUTUHAN PACKAGING"}),e.jsxs("p",{style:{color:"#64748b",margin:"5px 0 0 0",fontWeight:"500"},children:["Total ",c.length," Parts Diproses"]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("select",{value:f,onChange:t=>P(t.target.value),style:{padding:"10px 16px",borderRadius:"12px",border:"1px solid #e2e8f0",backgroundColor:"#fff",fontSize:"0.9rem",fontWeight:"600",color:"#334155",outline:"none",minWidth:"220px",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},children:[e.jsx("option",{value:"",children:"SEMUA CUSTOMER"}),p.map(t=>e.jsx("option",{value:t.id,children:(t.customer_name||t.name).toUpperCase()},t.id))]}),e.jsx("input",{type:"number",value:l,onChange:t=>N(t.target.value),style:{padding:"10px 16px",borderRadius:"12px",border:"1px solid #e2e8f0",width:"100px",fontWeight:"700",color:"#334155",textAlign:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"}}),e.jsxs(v,{color:"primary",onClick:U,style:{borderRadius:"12px",padding:"10px 20px",fontWeight:"700",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.25)",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(A,{icon:L})," IMPORT CSV"]}),e.jsx(v,{color:"success",onClick:y,disabled:I,style:{borderRadius:"12px",padding:"10px 20px",color:"white",fontWeight:"700",boxShadow:"0 4px 12px rgba(34, 197, 94, 0.25)",display:"flex",alignItems:"center",gap:"8px"},children:I?e.jsx(B,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:z})," HITUNG"]})})]})]})}),e.jsxs(F,{className:"g-4",children:[e.jsxs(w,{lg:9,children:[e.jsxs("div",{style:j,children:[e.jsx("h5",{style:{fontWeight:"700",marginBottom:"20px",color:"#1e293b",fontSize:"1.1rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:"FORECAST (pcs)/month"}),e.jsxs(W,{responsive:!0,hover:!0,style:{borderRadius:"12px",overflow:"hidden",border:"1px solid #f1f5f9"},children:[e.jsxs(R,{children:[e.jsxs(x,{children:[e.jsx(s,{rowSpan:2,style:r,children:"PART NUMBER"}),e.jsx(s,{rowSpan:2,style:r,children:"PART NAME"}),e.jsx(s,{rowSpan:2,style:r,children:"CUSTOMER"}),e.jsx(s,{colSpan:2,style:r,children:"PACKAGING"}),e.jsx(s,{colSpan:3,style:r,children:parseInt(l)-1}),e.jsx(s,{colSpan:2,style:r,children:l})]}),e.jsxs(x,{children:[e.jsx(s,{style:r,children:"JENIS"}),e.jsx(s,{style:r,children:"ISI"}),e.jsx(s,{style:r,children:"OCT"}),e.jsx(s,{style:r,children:"NOV"}),e.jsx(s,{style:r,children:"DEC"}),e.jsx(s,{style:r,children:"JAN"}),e.jsx(s,{style:r,children:"FEB"})]})]}),e.jsx(E,{children:c.map((t,a)=>e.jsxs(x,{children:[e.jsx(n,{style:{textAlign:"center",fontWeight:"700",color:"#334155"},children:t.part_number}),e.jsx(n,{style:{fontWeight:"600",color:"#475569"},children:t.part_name}),e.jsx(n,{style:{fontWeight:"600",color:"#475569"},children:t.customer_name}),e.jsx(n,{style:{textAlign:"center"},children:e.jsx("span",{style:{backgroundColor:"#f1f5f9",padding:"4px 10px",borderRadius:"6px",fontSize:"0.75rem",fontWeight:"700",color:"#64748b"},children:t.packaging})}),e.jsx(n,{style:{textAlign:"center",fontWeight:"700"},children:t.qty_packaging}),e.jsx(n,{style:{textAlign:"center"},children:t.forecasts[`Oktober_${parseInt(l)-1}`]?.toLocaleString()||0}),e.jsx(n,{style:{textAlign:"center"},children:t.forecasts[`November_${parseInt(l)-1}`]?.toLocaleString()||0}),e.jsx(n,{style:{textAlign:"center"},children:t.forecasts[`Desember_${parseInt(l)-1}`]?.toLocaleString()||0}),e.jsx(n,{style:{textAlign:"center"},children:t.forecasts[`Januari_${l}`]?.toLocaleString()||0}),e.jsx(n,{style:{textAlign:"center"},children:t.forecasts[`Februari_${l}`]?.toLocaleString()||0})]},a))})]})]}),e.jsxs("div",{style:j,children:[e.jsx("h5",{style:{fontWeight:"700",marginBottom:"20px",color:"#1e293b",fontSize:"1.1rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:"FORECAST (pcs)/day + Total Kebutuhan"}),e.jsxs(W,{responsive:!0,hover:!0,style:{borderRadius:"12px",overflow:"hidden",border:"1px solid #f1f5f9"},children:[e.jsxs(R,{children:[e.jsxs(x,{children:[e.jsx(s,{rowSpan:2,style:r,children:"PART NUMBER"}),e.jsx(s,{colSpan:2,style:r,children:"PACKAGING"}),e.jsx(s,{colSpan:3,style:r,children:parseInt(l)-1}),e.jsx(s,{colSpan:2,style:r,children:l}),e.jsx(s,{rowSpan:2,style:r,children:"ISI"}),e.jsx(s,{colSpan:3,style:r,children:"L/T"}),e.jsx(s,{colSpan:4,style:{...r,backgroundColor:"#1d4ed8 !important"},children:"KEBUTUHAN (UNIT)"}),e.jsx(s,{rowSpan:2,style:r,children:"ACTUAL"}),e.jsx(s,{rowSpan:2,style:r,children:"STATUS"}),e.jsx(s,{rowSpan:2,style:r,children:"GAP"})]}),e.jsxs(x,{children:[e.jsx(s,{style:r,children:"JENIS"}),e.jsx(s,{style:r,children:"QTY"}),e.jsx(s,{style:r,children:"OCT"}),e.jsx(s,{style:r,children:"NOV"}),e.jsx(s,{style:r,children:"DEC"}),e.jsx(s,{style:r,children:"JAN"}),e.jsx(s,{style:r,children:"FEB"}),e.jsx(s,{style:r,children:"PRD"}),e.jsx(s,{style:r,children:"ST"}),e.jsx(s,{style:r,children:"CUS"}),e.jsx(s,{style:{...r,backgroundColor:"#1d4ed8 !important"},children:"PRD"}),e.jsx(s,{style:{...r,backgroundColor:"#1d4ed8 !important"},children:"ST"}),e.jsx(s,{style:{...r,backgroundColor:"#1d4ed8 !important"},children:"CUS"}),e.jsx(s,{style:{...r,backgroundColor:"#1d4ed8 !important"},children:"TOTAL"})]})]}),e.jsx(E,{children:c.map((t,a)=>{const i=t.gap<0,d=t.gap>0,C=t.status==="Pass"?"#22c55e":t.status==="Kurang"?"#ef4444":"#f59e0b";return e.jsxs(x,{children:[e.jsx(n,{style:{textAlign:"center",fontWeight:"700"},children:t.part_number}),e.jsx(n,{style:{textAlign:"center"},children:t.packaging}),e.jsx(n,{style:{textAlign:"center",fontWeight:"700"},children:t.qty_packaging}),e.jsx(n,{style:{textAlign:"center"},children:Math.round((t.forecasts[`Oktober_${parseInt(l)-1}`]||0)/t.hari_kerja)}),e.jsx(n,{style:{textAlign:"center"},children:Math.round((t.forecasts[`November_${parseInt(l)-1}`]||0)/t.hari_kerja)}),e.jsx(n,{style:{textAlign:"center"},children:Math.round((t.forecasts[`Desember_${parseInt(l)-1}`]||0)/t.hari_kerja)}),e.jsx(n,{style:{textAlign:"center"},children:Math.round((t.forecasts[`Januari_${l}`]||0)/t.hari_kerja)}),e.jsx(n,{style:{textAlign:"center"},children:Math.round((t.forecasts[`Februari_${l}`]||0)/t.hari_kerja)}),e.jsx(n,{style:{textAlign:"center",fontWeight:"600"},children:t.qty_packaging}),e.jsx(n,{style:{textAlign:"center"},children:t.lt_production}),e.jsx(n,{style:{textAlign:"center"},children:t.lt_store}),e.jsx(n,{style:{textAlign:"center"},children:t.lt_customer}),e.jsx(n,{style:{textAlign:"center",fontWeight:"700",color:"#1d4ed8"},children:t.need_prod||0}),e.jsx(n,{style:{textAlign:"center",fontWeight:"700",color:"#1d4ed8"},children:t.need_store||0}),e.jsx(n,{style:{textAlign:"center",fontWeight:"700",color:"#1d4ed8"},children:t.need_cust||0}),e.jsx(n,{style:{textAlign:"center",fontWeight:"800",backgroundColor:"#eff6ff",color:"#1e3a8a"},children:t.total_need}),e.jsx(n,{style:{textAlign:"center",fontWeight:"800"},children:t.actual}),e.jsx(n,{style:{textAlign:"center"},children:e.jsx("span",{style:{padding:"4px 10px",borderRadius:"8px",fontSize:"0.75rem",fontWeight:"800",backgroundColor:`${C}15`,color:C,border:`1px solid ${C}30`},children:t.status.toUpperCase()})}),e.jsx(n,{style:{textAlign:"center"},children:e.jsx("div",{style:{background:d?"#dcfce7":i?"#fee2e2":"#f1f5f9",color:d?"#166534":i?"#991b1b":"#64748b",padding:"4px 8px",borderRadius:"6px",fontWeight:"800",fontSize:"0.8rem",border:`1px solid ${d?"#86efac":i?"#fca5a5":"#e2e8f0"}`,minWidth:"50px"},children:d?`▲ +${t.gap}`:i?`▼ ${t.gap}`:`● ${t.gap}`})})]},a)})})]})]})]}),e.jsx(w,{lg:3,children:e.jsxs("div",{style:{...j,position:"sticky",top:"24px"},children:[e.jsxs("h5",{style:{fontWeight:"800",marginBottom:"25px",color:"#1e293b",fontSize:"1.2rem",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(A,{icon:K,size:"lg",style:{color:"#3b82f6"}})," JUDGMENT"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsx(k,{label:"KURANG",count:S.Kurang,color:"#ef4444"}),e.jsx(k,{label:"LEBIH",count:S.Lebih,color:"#f59e0b"}),e.jsx(k,{label:"PASS",count:S.Pass,color:"#22c55e"})]}),e.jsx("div",{style:{marginTop:"30px",padding:"15px",borderRadius:"15px",background:"#eff6ff",border:"1px solid #dbeafe"},children:e.jsx("p",{style:{margin:0,fontSize:"0.8rem",color:"#1e40af",fontWeight:"600",lineHeight:"1.5"},children:"* Kebutuhan unit dihitung berdasarkan akumulasi Lead Time harian terhadap rata-rata forecast bulanan."})})]})})]})]})},k=({label:g,count:m,color:p})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px 20px",borderRadius:"15px",backgroundColor:"#fff",border:"1px solid #f1f5f9",boxShadow:"0 4px 6px rgba(0,0,0,0.02)",transition:"all 0.2s ease"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"10px",height:"10px",backgroundColor:p,borderRadius:"50%",boxShadow:`0 0 10px ${p}80`}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"700",color:"#475569",letterSpacing:"0.5px"},children:g})]}),e.jsx("span",{style:{fontWeight:"800",color:p,fontSize:"1.4rem"},children:m})]});export{X as default};
